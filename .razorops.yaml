version: v2
global:
  runner:
    os_image: ubuntu
  variables:
    - RACK_ENV=test
tasks:
  Build:
   steps:
     - checkout
     - commands:
         - sudo apt install python3
         - python3 -m http.server
  deploy-to-dev:
    steps:
      - checkout
      - commands: 
          - az login --service-principal -u $APP_ID -p $PASS --tenant $TENANT
          - az storage blob upload-batch -s build/ -d '$web' --account-name razorops --overwrite true
    when: branch == 'main'
     
  - reports/html:
      dir: coverage
      index: index.html
